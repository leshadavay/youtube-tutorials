<!DOCTYPE html>
<html>
  <head>
    <title>Ob havo</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/slick-loader@1.1.20/slick-loader.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      href="https://unpkg.com/nprogress@0.2.0/nprogress.css"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
      integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
      integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script src="https://unpkg.com/slick-loader@1.1.20/slick-loader.min.js"></script>
    <link href="./style.css" rel="stylesheet" />
  </head>
  <body>
    <div class="clouds">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64">
        <defs>
          <linearGradient
            id="0"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(-2.12393 0 0 2.13534 1576.02-955.55)"
            x1="393.83"
            y1="549.46"
            x2="395.79"
            y2="542.83"
          >
            <stop stop-color="#c8e1e8" />
            <stop offset="1" stop-color="#fff" />
          </linearGradient>
          <linearGradient
            id="1"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(2.07793 0 0 2.08909-503.11-599.88)"
            x1="393.83"
            y1="549.46"
            x2="390.45"
            y2="542.88"
          >
            <stop stop-color="#c3e6ee" />
            <stop offset="1" stop-color="#fff" />
          </linearGradient>
          <linearGradient
            id="2"
            gradientUnits="userSpaceOnUse"
            gradientTransform="matrix(2.07793 0 0 2.08909-503.11-599.88)"
            x1="396.64"
            y1="546.11"
            x2="394.41"
            y2="538.61"
          >
            <stop stop-color="#b7d7e1" />
            <stop offset="1" stop-color="#fff" />
          </linearGradient>
        </defs>
        <g transform="matrix(1.06658 0 0 1.06658-745.92-181.44)">
          <path
            d="m311.11 530.14c-.874-.686-1.973-1.095-3.165-1.095-2.808 0-5.093 2.265-5.165 5.087-2.898 1.099-4.961 3.927-4.961 7.241 0 3.916 2.879 7.151 6.613 7.662v.07h26.451v-.013c3.688-.216 6.613-3.309 6.613-7.093 0-3.649-2.72-6.655-6.222-7.06.014-.222.022-.447.022-.673 0-5.655-4.719-10.239-10.539-10.239-4.308 0-8.01 2.512-9.647 6.11"
            fill="url(#2)"
            transform="matrix(1.21605 0 0 1.21605 343.92-455.87)"
          />
          <path
            d="m311.11 530.14c-.874-.686-1.973-1.095-3.165-1.095-2.808 0-5.093 2.265-5.165 5.087-2.898 1.099-4.961 3.927-4.961 7.241 0 3.916 2.879 7.151 6.613 7.662v.07h26.451v-.013c3.688-.216 6.613-3.309 6.613-7.093 0-3.649-2.72-6.655-6.222-7.06.014-.222.022-.447.022-.673 0-5.655-4.719-10.239-10.539-10.239-4.308 0-8.01 2.512-9.647 6.11"
            fill="url(#1)"
            transform="matrix(.7693 0 0 .7693 472.24-205.63)"
          />
          <path
            d="m743.78 199.48c.894-.702 2.02-1.119 3.235-1.119 2.87 0 5.205 2.315 5.279 5.2 2.963 1.124 5.071 4.01 5.071 7.402 0 4-2.942 7.31-6.759 7.831v.072h-27.04v-.013c-3.77-.221-6.759-3.382-6.759-7.25 0-3.73 2.78-6.802 6.36-7.215-.015-.227-.023-.457-.023-.688 0-5.78 4.823-10.466 10.773-10.466 4.404 0 8.19 2.567 9.861 6.245"
            fill="url(#0)"
          />
        </g>
      </svg>
    </div>
    <div id="container" class="m-5">
      <div class="row">
        <div data-aos="fade-up">
          <div class="search">
            <input
              type="text"
              name="davlat"
              placeholder="Davlat nomini kiriting"
              class="text"
            />
            <span onclick="myFunction()" style="cursor: pointer">üîç</span>
          </div>
        </div>
        <h1 id="davlat_nomi" class="text-center mt-5"></h1>
        <div id="ob_havo" class="row"></div>
      </div>
    </div>

    <div
      class="modal fade"
      id="modal_xabar"
      data-bs-backdrop="static"
      data-bs-keyboard="false"
      tabindex="-1"
      aria-labelledby="staticBackdropLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="staticBackdropLabel">Xabar</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">asdjkfksd</div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Yopish
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      const callApi = function (davlat_nomi) {
        SlickLoader.enable();
        return new Promise(function (resolve, reject) {
          //serverga zapros jonatish
          $.ajax({
            url: "https://weatherdbi.herokuapp.com/data/weather/" + davlat_nomi,
            type: "GET",

            success: function (data) {
              SlickLoader.disable();
              resolve(data);
            },
            error: function (error) {
              SlickLoader.disable();
              reject(error);
            },
          });
        });
      };

      const myFunction = async function () {
        let davlat_nomi = document.querySelector("input[name=davlat]").value;
        if (!davlat_nomi.trim()) {
          modalOpen("Davlat nomini yozing");
        } else {
          //serverga zapros jonatish
          const result = await callApi(davlat_nomi);
          const status = result.status;

          if (status === "fail") {
            modalOpen("Davlat nomini to'g'ri kiriting!");
            return;
          }

          const region = result.region;
          const next_days = result.next_days;

          let html = "";
          for (let day of next_days) {
            html += `
              <div class="col" data-aos="fade-up">
                <div class="card">
                  <img src="${day.iconURL}" class="card-img-top" alt="...">
                  <div class="card-body">
                    <h5 class="card-title">${day.day}</h5>
                    <p class="card-text">${day.comment}</p>
                    <p class="card-text">${day.min_temp.c} - ${day.max_temp.c}</p>

                  </div>
                </div>
              </div>
              
                `;
          }

          document.getElementById("davlat_nomi").innerText = region;
          document.getElementById("ob_havo").innerHTML = html;

          console.log("result: ", result);
        }
      };

      const modalOpen = function (message) {
        modal = $("#modal_xabar");
        modal.find(".modal-body").text(message);
        modal.modal("show");
      };

      $(document).ready(function () {
        NProgress.start();
        NProgress.done();
        AOS.init();
        document
          .querySelector("input[name=davlat]")
          .addEventListener("keyup", function (event) {
            if (event.keyCode === 13) {
              myFunction();
            }
          });
      });
    </script>
  </body>
</html>
