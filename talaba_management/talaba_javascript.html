<!DOCTYPE html>
<html>
  <head>
    <title>Talaba</title>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- Yangi talaba Modal -->
    <div
      class="modal fade"
      id="yangi_talaba_modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <form id="yangi_talaba_form">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Yangi talaba</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="fio">Familyasi va Ismi</label>
                <input
                  type="text"
                  class="form-control"
                  name="fio"
                  id="fio"
                  aria-describedby="emailHelp"
                  placeholder="Familyasi va Ismi"
                />
              </div>
              <div class="form-group">
                <label for="tel">Telefoni</label>
                <input
                  type="text"
                  class="form-control"
                  name="tel"
                  id="tel"
                  placeholder="Telefoni"
                />
              </div>
              <div class="form-group">
                <label for="jinsi">Jinsi</label>
                <select class="form-control" id="jinsi" name="jinsi">
                  <option value="Erkak">Erkak</option>
                  <option value="Ayol">Ayol</option>
                </select>
              </div>
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  name="armiya"
                  id="armiya"
                />
                <label class="form-check-label" for="armiya">Armiya</label>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Yop
              </button>
              <button
                type="button"
                class="btn btn-primary"
                name="submit"
                data-dismiss="modal"
              >
                Saqla
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- talabani ozgartirish Modal -->
    <div
      class="modal fade"
      id="update_talaba_modal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <form id="update_talaba_form">
            <div class="modal-header">
              <h5 class="modal-title">Talaba ma'lumoti</h5>
              <button
                type="button"
                class="close"
                data-dismiss="modal"
                aria-label="Close"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="fio">Familyasi va Ismi</label>
                <input
                  type="text"
                  class="form-control"
                  name="fio"
                  id="fio"
                  aria-describedby="emailHelp"
                  placeholder="Familyasi va Ismi"
                />
              </div>
              <div class="form-group">
                <label for="tel">Telefoni</label>
                <input
                  type="text"
                  class="form-control"
                  name="tel"
                  id="tel"
                  placeholder="Telefoni"
                />
              </div>
              <div class="form-group">
                <label for="jinsi">Jinsi</label>
                <select class="form-control" id="jinsi" name="jinsi">
                  <option value="Erkak">Erkak</option>
                  <option value="Ayol">Ayol</option>
                </select>
              </div>
              <div class="form-check">
                <input
                  type="checkbox"
                  class="form-check-input"
                  name="armiya"
                  id="armiya"
                />
                <label class="form-check-label" for="armiya">Armiya</label>
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-dismiss="modal"
              >
                Yop
              </button>
              <button
                type="button"
                class="btn btn-primary"
                name="update"
                data-dismiss="modal"
              >
                O'zgartir
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <div class="row m-5 card">
        <h1 class="text-danger text-center">Talabalar</h1>
        <div class="d-flex justify-content-end">
          <button
            class="btn btn-outline-primary"
            data-toggle="modal"
            data-target="#yangi_talaba_modal"
            onclick="yangiTalabaModalOpen()"
          >
            Yangi
          </button>
        </div>
        <table class="table table-hover table-striped" id="studentlar_jadvali">
          <thead class="bg-dark text-light">
            <tr>
              <th scope="col">#</th>
              <th scope="col">F I O</th>
              <th scope="col">Tel</th>
              <th scope="col">Jinsi</th>
              <th scope="col">Armiya</th>
              <th scope="col">Sana</th>
              <th scope="col"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <script>
      let studentlar = [];
      let yangi_talaba_form = document.getElementById("yangi_talaba_form");
      let update_talaba_form = document.getElementById("update_talaba_form");
      let jadval = document
        .getElementById("studentlar_jadvali")
        .querySelector("tbody");

      function yandiTalabaInsertHandler() {
        let fio = yangi_talaba_form.querySelector("input[name=fio]").value;
        let tel = yangi_talaba_form.querySelector("input[name=tel]").value;
        let jinsi = yangi_talaba_form.querySelector("select[name=jinsi]").value;
        let armiya =
          yangi_talaba_form.querySelector("input[name=armiya]").checked;

        if (!fio.trim()) {
          alert("Familyasi va Ismini kiriting");
          return false;
        }
        if (!tel.trim()) {
          alert("Telefonini kiriting");
          return false;
        }
        let yangiStudent = {
          fio,
          tel,
          jinsi,
          armiya,
          sana: new Date(),
        };
        studentlar.push(yangiStudent);
        insertIntoStorage();
        printSingleStudent(studentlar.length, yangiStudent);
      }

      function yangiTalabaModalOpen() {
        yangi_talaba_form.reset();

        yangi_talaba_form
          .querySelector("button[name=submit]")
          .removeEventListener("click", yandiTalabaInsertHandler, false);
        yangi_talaba_form
          .querySelector("button[name=submit]")
          .addEventListener("click", yandiTalabaInsertHandler);
      }
      function yangiTalabaUpdatetHandler(index) {
        let fio = update_talaba_form.querySelector("input[name=fio]").value;
        let tel = update_talaba_form.querySelector("input[name=tel]").value;
        let jinsi =
          update_talaba_form.querySelector("select[name=jinsi]").value;
        let armiya =
          update_talaba_form.querySelector("input[name=armiya]").checked;

        studentlar[index] = {
          fio,
          tel,
          jinsi, //jinsi: jinsi
          armiya, //armiya: armiya
          sana: new Date(),
        };
        insertIntoStorage();
        printAllStudent();
      }
      function talabaniOzgartirModalOpen(index) {
        const student = studentlar[index];
        update_talaba_form.querySelector("input[name=fio]").value = student.fio;
        update_talaba_form.querySelector("input[name=tel]").value = student.tel;
        update_talaba_form.querySelector("select[name=jinsi]").value =
          student.jinsi;
        update_talaba_form.querySelector("input[name=armiya]").checked =
          student.armiya;

        update_talaba_form
          .querySelector("button[name=update]")
          .removeEventListener(
            "click",
            function () {
              yangiTalabaUpdatetHandler(index);
            },
            false
          );

        update_talaba_form
          .querySelector("button[name=update]")
          .addEventListener("click", function () {
            yangiTalabaUpdatetHandler(index);
          });
      }

      function talabaniOchir(index) {
        if (confirm("Rostdan ham ochirasizmi?")) {
          delete studentlar[index];
          printAllStudent();
        }
      }

      function fetchFromStorage() {
        let data = localStorage.getItem("studentlar");
        if (data) {
          studentlar = JSON.parse(data);
        }
      }
      function insertIntoStorage() {
        localStorage.setItem("studentlar", JSON.stringify(studentlar));
      }
      function printAllStudent() {
        jadval.innerHTML = "";
        for (let index in studentlar) {
          if (studentlar[index]) {
            printSingleStudent(parseInt(index) + 1, studentlar[index]);
          }
        }
      }

      function printSingleStudent(index, student) {
        jadval.innerHTML += `
           <tr>
              <td>${index}</td>
              <td>${student.fio}</td>
              <td>${student.tel}</td>
              <td>${student.jinsi}</td>
              <td>${student.armiya ? "Xa" : "Yo'q"}</td>
              <td>${student.sana.toLocaleString()}</td>
              <td>
                <button class="btn btn-info btn-sm"
                data-toggle="modal"
                data-target="#update_talaba_modal"
                onclick="talabaniOzgartirModalOpen(${index - 1})"
                >
                  <i class="bi bi-pencil-fill"></i>
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="talabaniOchir(${
                    index - 1
                  })" >
                  <i class="bi bi-trash-fill"></i>
                    </button>
              </td>
            </tr>
          `;
      }

      document.addEventListener("DOMContentLoaded", function (event) {
        fetchFromStorage();
        printAllStudent();
      });
    </script>
  </body>
</html>
